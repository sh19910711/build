language: go
go: 1.6
go_import_path: github.com/codestand/build
sudo: required
services:
  - docker

install:
  - make init
  - govendor list
  - make build
  - docker build -t build -f example/build.docker .

script:
  - make test
  - make run &
  - sleep 7
  - curl --form "file=@example/app.tar" http://localhost:8080/builds
  - PORT=8888 go run test/callback_server.go --timeout 3 || exit 1
  - ./tmp/app

cache:
  directories:
    - vendor
